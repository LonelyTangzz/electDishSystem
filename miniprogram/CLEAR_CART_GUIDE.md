# 清空购物车指南

## 为什么需要清空购物车？

如果你之前添加了菜品到购物车，但那时菜品数据还没有 `stars`（爱心）字段，现在即使更新了代码，购物车里的旧数据也不会自动更新。

## 🔧 已自动修复

我已经修改了代码，现在购物车和订单页面会自动从最新的菜品数据中获取 `stars` 字段，**无需手动清空购物车**！

### 修改的文件
- `miniprogram/pages/cart/cart.js` - 自动更新菜品stars字段
- `miniprogram/pages/order/order.js` - 自动更新菜品stars字段

## 📱 如何验证

### 1. 重新编译
```
点击"编译"按钮
```

### 2. 测试步骤
1. 进入首页（点餐页面）
2. 看到菜品显示爱心 ❤️❤️❤️
3. 点击 [+] 添加菜品到购物车
4. 进入购物车页面
5. 应该能看到：
   - 单价：❤️❤️❤️
   - 小计：❤️❤️❤️❤️❤️（如果数量是2）
   - 合计：❤️❤️❤️...（底部结算栏）

## 🛒 购物车爱心显示位置

### 购物车页面显示结构
```
┌────────────────────────────┐
│ 🍗 宫保鸡丁                │
│ ❤️❤️❤️❤️  ← 单价（4颗）    │
│                            │
│ [-] 2 [+]                  │
│ 小计 ❤️❤️❤️❤️❤️❤️❤️❤️        │
│      ↑ 这里！（2x4=8颗）    │
└────────────────────────────┘

底部结算栏：
┌────────────────────────────┐
│ 合计 ❤️❤️❤️❤️❤️❤️❤️❤️❤️      │
│      ↑ 这里显示总爱心数      │
│            [去结算]          │
└────────────────────────────┘
```

## 🎨 订单页面显示结构
```
订单明细
├─ 🍗 宫保鸡丁 x2  ❤️❤️❤️❤️❤️❤️❤️❤️
│                  ↑ 这里！
├─ 🥒 拍黄瓜 x1    ❤️
└──────────────────────────
小计：❤️❤️❤️❤️❤️❤️❤️❤️❤️
      ↑ 这里！
配送费：❤️
───────────────────────────
合计：❤️❤️❤️❤️❤️❤️❤️❤️❤️❤️
      ↑ 这里！
```

## 🔍 如果还是看不到爱心

### 方法1：清除缓存（推荐）
1. 点击 **"工具"** → **"清除缓存"** → **"清除所有缓存"**
2. 点击 **"编译"**
3. 重新添加菜品到购物车测试

### 方法2：手动清空购物车
1. 进入购物车页面
2. 点击 **"清空购物车"** 按钮
3. 回到首页重新添加菜品
4. 再查看购物车

### 方法3：检查控制台
1. 打开控制台（Console）
2. 查看是否有错误
3. 查找包含 "购物车数据" 的日志
4. 应该能看到 "总爱心数: X"

### 方法4：真机测试
有时开发工具有缓存问题，建议：
1. 点击 **"预览"**
2. 用手机扫码
3. 在真机上测试

## 🐛 调试技巧

### 查看购物车数据
在控制台输入：
```javascript
const cart = wx.getStorageSync('cart');
console.log(cart);
```

应该看到每个菜品都有 `stars` 字段。

### 查看某个菜品的stars
```javascript
const dishData = require('./utils/dishData.js');
const dish = dishData.getDishById('1'); // 宫保鸡丁
console.log(dish.stars); // 应该显示 4
```

## ✅ 验证清单

完成以下步骤，确认爱心显示正常：

- [ ] 首页菜品显示爱心 ❤️
- [ ] 购物车单价显示爱心 ❤️
- [ ] 购物车小计显示爱心 ❤️❤️...
- [ ] 购物车合计显示爱心（底部）
- [ ] 订单页商品显示爱心 ❤️
- [ ] 订单页小计显示爱心 ❤️❤️...
- [ ] 订单页合计显示爱心 ❤️❤️...

## 💡 原理说明

### 问题原因
购物车保存的是完整的菜品对象到本地存储。当你之前添加菜品时，菜品对象还没有 `stars` 字段，所以保存的数据也没有。

### 解决方案
现在代码会在加载购物车数据时，自动从最新的 `dishData.js` 中查找对应菜品，获取最新的 `stars` 值，确保显示正确。

### 代码片段
```javascript
// 从最新的菜品数据中获取stars字段
const latestDish = dishData.getDishById(item.dish.id);
const stars = latestDish ? latestDish.stars : 0;
```

---

**重新编译后就能看到爱心啦！** ❤️❤️❤️

