<!--pages/orders/orders.wxml-->
<view class="container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!hasUserInfo}}" class="empty-state">
    <view class="empty-icon">ğŸ”</view>
    <view class="empty-text">è¯·å…ˆç™»å½•æŸ¥çœ‹è®¢å•</view>
    <button class="login-btn btn-primary" bindtap="goToLogin">å»ç™»å½•</button>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view wx:else>
    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-state">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <view wx:elif="{{orders.length > 0}}" class="orders-list">
      <view 
        wx:for="{{orders}}" 
        wx:key="_id"
        class="order-card card"
      >
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <view class="order-info">
            <text class="order-number">è®¢å•å·ï¼š{{item._id.substring(0, 10)}}</text>
            <text class="order-time">{{item.formattedTime}}</text>
          </view>
          <view class="order-status {{item.status}}">
            {{item.statusText}}
          </view>
        </view>

        <!-- è®¢å•å•†å“ -->
        <view class="order-items">
          <view 
            wx:for="{{item.items}}" 
            wx:for-item="dish"
            wx:key="dish.id"
            class="order-item"
          >
            <view class="item-emoji">{{dish.dish.emoji}}</view>
            <view class="item-detail">
              <text class="item-name">{{dish.dish.name}}</text>
              <text class="item-quantity">x{{dish.quantity}}</text>
            </view>
            <view class="item-stars">
              <block wx:for="{{dish.totalStars}}" wx:for-item="star" wx:key="*this">
                <text class="star-icon">â¤ï¸</text>
              </block>
            </view>
          </view>
        </view>

        <!-- è®¢å•åº•éƒ¨ -->
        <view class="order-footer">
          <view class="order-total">
            <text class="total-label">æ€»è®¡ï¼š</text>
            <view class="total-stars">
              <block wx:for="{{item.totalStars}}" wx:for-item="star" wx:key="*this">
                <text class="star-icon">â¤ï¸</text>
              </block>
            </view>
          </view>
          
          <view class="order-actions">
            <button 
              wx:if="{{item.canReview}}" 
              class="action-btn review-btn"
              data-id="{{item._id}}"
              data-index="{{index}}"
              bindtap="goToReview"
            >
              å»è¯„ä»·
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºè®¢å•çŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">è¿˜æ²¡æœ‰è®¢å•\nå¿«å»ç‚¹é¤å§ï¼</view>
      <button class="order-btn btn-primary" bindtap="goToIndex">å»ç‚¹é¤</button>
    </view>
  </view>
</view>

