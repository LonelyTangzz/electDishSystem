<!--pages/mine/mine.wxml-->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card card">
    <view wx:if="{{hasUserInfo}}" class="user-info">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
      <view class="user-detail">
        <text class="nickname">{{userInfo.nickName}}</text>
        <text class="welcome">欢迎来到阿汤的小食堂</text>
      </view>
    </view>
    
    <view wx:else class="login-container">
      <!-- 头像选择 -->
      <button class="avatar-wrapper" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image class="avatar-placeholder" src="{{userAvatarTemp || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}" mode="aspectFill" />
      </button>
      
      <view class="login-text">
        <text class="login-title">欢迎来到阿汤的小食堂</text>
        <text class="login-desc">点击头像设置，输入昵称完成登录</text>
      </view>
      
      <!-- 昵称输入 -->
      <view class="nickname-input-wrapper">
        <input 
          type="nickname" 
          class="nickname-input" 
          placeholder="请输入昵称"
          value="{{userNicknameTemp}}"
          bindchange="onNicknameChange"
        />
      </view>
      
      <!-- 确认登录按钮 -->
      <button class="login-btn" bindtap="handleNewLogin">
        <text class="login-btn-icon">🔐</text>
        <text class="login-btn-text">完成登录</text>
      </button>
      
      <!-- 或者使用旧方式（降级方案） -->
      <view class="login-divider">
        <text class="divider-text">或</text>
      </view>
      
      <button class="login-btn-secondary" bindtap="handleOldLogin">
        <text class="login-btn-text">使用getUserProfile登录</text>
      </button>
    </view>
  </view>

  <!-- 配对信息卡片 -->
  <view wx:if="{{hasUserInfo}}" class="couple-card card">
    <view class="couple-header">
      <text class="couple-icon">💑</text>
      <text class="couple-title">配对信息</text>
    </view>
    
    <!-- 已配对 -->
    <view wx:if="{{partnerOpenid}}" class="couple-paired">
      <view class="paired-info">
        <text class="paired-label">已与TA配对</text>
        <text class="paired-desc">互相为对方做美食 ❤️</text>
      </view>
      <button class="btn-unpair" bindtap="unpairPartner">解除配对</button>
    </view>
    
    <!-- 未配对 -->
    <view wx:else class="couple-unpaired">
      <view class="my-openid">
        <text class="openid-label">我的配对码：</text>
        <view class="openid-box" bindtap="copyMyOpenid">
          <text class="openid-text">{{myOpenid}}</text>
          <text class="copy-icon">📋</text>
        </view>
        <text class="openid-tip">点击复制，发给TA</text>
      </view>
      
      <view class="input-partner">
        <text class="input-label">输入TA的配对码：</text>
        <input 
          class="partner-input" 
          placeholder="粘贴TA的配对码"
          value="{{partnerInputValue}}"
          bindinput="onPartnerInput"
        />
        <button class="btn-pair" bindtap="pairWithPartner">
          💕 配对
        </button>
      </view>
    </view>
  </view>

  <!-- 订单统计 -->
  <view wx:if="{{hasUserInfo}}" class="stats-card card">
    <view class="stats-item" bindtap="goToOrders" data-status="pending">
      <text class="stats-number">{{orderStats.pending}}</text>
      <text class="stats-label">待完成</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item" bindtap="goToOrders" data-status="completed">
      <text class="stats-number">{{orderStats.completed}}</text>
      <text class="stats-label">已完成</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item" bindtap="goToOrders">
      <text class="stats-number">{{orderStats.total}}</text>
      <text class="stats-label">全部订单</text>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-item card" bindtap="goToOrders">
      <text class="menu-icon">📋</text>
      <text class="menu-title">我的订单</text>
      <text class="menu-arrow">›</text>
    </view>

    <!-- 云数据库初始化按钮（仅开发时显示） -->
    <view wx:if="{{!demoMode && hasUserInfo}}" class="menu-item card" bindtap="initCloudDishes">
      <text class="menu-icon">☁️</text>
      <text class="menu-title">初始化云数据库</text>
      <text class="menu-arrow">›</text>
    </view>

    <view wx:if="{{hasUserInfo}}" class="menu-item card" bindtap="logout">
      <text class="menu-icon">🚪</text>
      <text class="menu-title">退出登录</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- Demo模式提示 -->
  <view wx:if="{{demoMode}}" class="demo-tip">
    💡 当前为Demo模式，数据保存在本地
  </view>
</view>
