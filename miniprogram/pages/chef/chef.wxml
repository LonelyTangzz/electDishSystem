<!--miniprogram/pages/chef/chef.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-bar">
    <view class="stat-item">
      <text class="stat-number">{{stats.pending}}</text>
      <text class="stat-label">TAè¦åƒ</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{stats.cooking}}</text>
      <text class="stat-label">æ­£åœ¨åš</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{stats.completed}}</text>
      <text class="stat-label">ä»Šæ—¥å®Œæˆ</text>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === 'pending' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="pending"
    >
      TAè¦åƒ ({{stats.pending}})
    </view>
    <view 
      class="tab-item {{currentTab === 'cooking' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="cooking"
    >
      æ­£åœ¨åš ({{stats.cooking}})
    </view>
    <view 
      class="tab-item {{currentTab === 'completed' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="completed"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y>
    <view wx:if="{{orders.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ’•</text>
      <text class="empty-text">TAè¿˜æ²¡ç‚¹é¤å“¦~</text>
    </view>

    <view wx:for="{{orders}}" wx:key="_id" class="order-card">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-info">
          <text class="order-number">è®¢å• #{{item.orderNumber}}</text>
          <text class="order-time">{{item.createTimeFormatted}}</text>
        </view>
        <view class="status-badge status-{{item.status}}">
          {{item.statusText}}
        </view>
      </view>

      <!-- é¡¾å®¢ä¿¡æ¯ -->
      <view class="customer-info">
        <text class="customer-icon">ğŸ’‘</text>
        <text class="customer-name">{{item.contactPerson || 'TA'}}</text>
        <text wx:if="{{item.remark}}" class="remark-icon">ğŸ’¬</text>
      </view>

      <!-- å¤‡æ³¨ä¿¡æ¯ -->
      <view wx:if="{{item.remark}}" class="remark-box">
        <text class="remark-label">å¤‡æ³¨ï¼š</text>
        <text class="remark-text">{{item.remark}}</text>
      </view>

      <!-- èœå“åˆ—è¡¨ -->
      <view class="dishes-list">
        <view wx:for="{{item.items}}" wx:for-item="dish" wx:key="id" class="dish-item">
          <view class="dish-info">
            <text class="dish-emoji">{{dish.emoji}}</text>
            <text class="dish-name">{{dish.name}}</text>
            <text class="dish-quantity">x{{dish.quantity}}</text>
          </view>
          <text class="dish-price">Â¥{{dish.subtotal}}</text>
        </view>
      </view>

      <!-- è®¢å•æ€»è®¡ -->
      <view class="order-footer">
        <text class="total-label">åˆè®¡ï¼š</text>
        <text class="total-price">Â¥{{item.totalAmount}}</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <!-- å¾…å¤„ç†çŠ¶æ€ -->
        <block wx:if="{{item.status === 'pending'}}">
          <button 
            class="btn btn-primary" 
            bindtap="acceptOrder" 
            data-id="{{item._id}}"
          >
            ğŸ’ª å¼€å§‹åš
          </button>
        </block>

        <!-- åˆ¶ä½œä¸­çŠ¶æ€ -->
        <block wx:if="{{item.status === 'cooking'}}">
          <button 
            class="btn btn-success" 
            bindtap="completeOrder" 
            data-id="{{item._id}}"
          >
            âœ… åšå¥½äº†
          </button>
        </block>

        <!-- å·²å®ŒæˆçŠ¶æ€ -->
        <block wx:if="{{item.status === 'completed'}}">
          <text class="completed-time">{{item.completedTimeFormatted}}</text>
        </block>
      </view>
    </view>
  </scroll-view>

  <!-- åˆ·æ–°æŒ‰é’® -->
  <view class="refresh-btn" bindtap="refreshOrders">
    <text class="refresh-icon">ğŸ”„</text>
  </view>
</view>

